<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Cropper - Utilo</title>
    <link rel="stylesheet" href="../css/style.css" />
  </head>
  <body>
    <header>
      <div class="header-content container">
        <a href="../index.html" class="logo">üß∞ Utilo</a>
        <nav class="nav-links">
          <a href="../index.html">‚Üê Back to Tools</a>
          <button id="theme-toggle" class="theme-toggle">üåô</button>
        </nav>
      </div>
    </header>

    <div class="tool-container">
      <div class="tool-panel">
        <div class="tool-panel-input" style="gap: 1rem;">
          <label class="tool-panel-label">Upload Image</label>
          <input type="file" id="file-input" accept="image/*" />
          <div class="form-group">
            <label class="tool-panel-label">X Position (px)</label>
            <input type="number" id="crop-x" value="0" min="0" />
          </div>
          <div class="form-group">
            <label class="tool-panel-label">Y Position (px)</label>
            <input type="number" id="crop-y" value="0" min="0" />
          </div>
          <div class="form-group">
            <label class="tool-panel-label">Width (px)</label>
            <input type="number" id="crop-width" value="100" min="1" />
          </div>
          <div class="form-group">
            <label class="tool-panel-label">Height (px)</label>
            <input type="number" id="crop-height" value="100" min="1" />
          </div>
          <button id="crop-btn" class="btn btn-primary" style="width: 100%;">Crop</button>
        </div>
      </div>

      <div class="tool-panel">
        <div class="tool-panel-output">
          <label class="tool-panel-label">Result</label>
          <canvas id="canvas" style="max-width: 100%; border: 1px solid var(--border); border-radius: 0.5rem;"></canvas>
        </div>
        <div class="tool-controls">
          <button id="download-btn" class="btn btn-primary">Download</button>
          <button id="clear-btn" class="btn btn-danger">Clear</button>
        </div>
      </div>
    </div>

    <script src="../js/utils.js"></script>
    <script>
      const fileInput = document.getElementById('file-input');
      const cropXInput = document.getElementById('crop-x');
      const cropYInput = document.getElementById('crop-y');
      const cropWidthInput = document.getElementById('crop-width');
      const cropHeightInput = document.getElementById('crop-height');
      const cropBtn = document.getElementById('crop-btn');
      const canvas = document.getElementById('canvas');
      const downloadBtn = document.getElementById('download-btn');

      let originalImg = null;

      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            originalImg = new Image();
            originalImg.onload = () => {
              cropWidthInput.value = originalImg.width;
              cropHeightInput.value = originalImg.height;
            };
            originalImg.src = event.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      cropBtn.addEventListener('click', () => {
        if (!originalImg) return;
        const x = parseInt(cropXInput.value);
        const y = parseInt(cropYInput.value);
        const width = parseInt(cropWidthInput.value);
        const height = parseInt(cropHeightInput.value);

        canvas.width = width;
        canvas.height = height;
        canvas.getContext('2d').drawImage(originalImg, x, y, width, height, 0, 0, width, height);
      });

      downloadBtn.addEventListener('click', () => {
        canvas.toBlob((blob) => {
          downloadFile(blob, 'cropped-image.png', 'image/png');
        });
      });

      document.getElementById('clear-btn').addEventListener('click', () => {
        fileInput.value = '';
        canvas.width = 0;
        originalImg = null;
      });
    </script>
  </body>
</html>
